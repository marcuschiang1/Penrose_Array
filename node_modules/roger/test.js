/* jshint globalstrict: true, strict: false, undef: true, unused: true,
          trailing: true, browser: true, smarttabs:true */
/* global require, console */

var roger = require('./lib/roger'),
    fs = require('fs'),
    Project = roger.Project,
    q = require('q');

require('colors');

var outputFile = 'test_deps.js';

console.time('Test Total');
console.time('Test Get');

q.longStackSupport = true;


Project.get('/Users/rollyfordham/TokBox/webrtc-js/')
  .then(function(project) {
    console.log(project);
    console.timeEnd('Test Get');

    // by here the project config has been loaded and all it's dependencies
    // have been retrieved. i.e. repos have been cloned/updated but nothing
    // have been built yet.

    console.log(('\n\nProject dependencies for ' + project.fullName.bold).green);

    if (project.dependencies.length > 0) {
      console.log(project.dependencies.valueOf().green);
      console.log('\n\n');
    }

    return project;
  })
  .then(function(project) {
    console.time('Test Build');

    project.build()
      .then(function(dependencies) {
        console.timeEnd('Test Build');
        console.timeEnd('Test Total');

        return dependencies.writeToFile(outputFile)
                        .then(function() {
                          console.log(('\nProject source written to ' +
                                        outputFile.underline + '\n').green.bold);
                        });
      }, function(err) {
        console.error(('FAILED: ' + err).red.bold);
      });
  })
  .catch(function(err) {
    console.error(err);
  })
  .done();
